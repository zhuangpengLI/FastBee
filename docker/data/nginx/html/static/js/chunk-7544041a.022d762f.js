(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7544041a","chunk-7c5661b0","chunk-1022b97a","chunk-722c5e57"],{"09cb":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));i("d3b7");function a(){return new Promise((function(e,t){if("undefined"!==typeof BMap)return e(BMap),!0;window.onBMapCallback=function(){e(BMap)};var i=document.location.protocol;if("https:"==i){var a=document.createElement("meta");a.httpEquiv="Content-Security-Policy",a.content="upgrade-insecure-requests",a.onerror=t,document.head.appendChild(a)}var r=document.createElement("script");r.type="text/javascript",r.src="http://api.map.baidu.com/api?v=2.0&ak=nAtaBg9FYzav6c8P9rF9qzsWZXXXXXX&__ec_v__=20190126&callback=onBMapCallback",r.onerror=t,document.head.appendChild(r)}))}},2544:function(e,t,i){"use strict";i.d(t,"e",(function(){return r})),i.d(t,"d",(function(){return n})),i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),i.d(t,"f",(function(){return l})),i.d(t,"c",(function(){return c}));var a=i("b775");function r(e){return Object(a["a"])({url:"/iot/deviceUser/list",method:"get",params:e})}function n(e,t){return Object(a["a"])({url:"/iot/deviceUser/"+e+"/"+t,method:"get"})}function o(e){return Object(a["a"])({url:"/iot/deviceUser",method:"post",data:e})}function s(e){return Object(a["a"])({url:"/iot/deviceUser/addDeviceUsers",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/iot/deviceUser",method:"put",data:e})}function c(e){return Object(a["a"])({url:"/iot/deviceUser",method:"delete",data:e})}},"32d1":function(e,t,i){e.exports=i.p+"static/img/product.8957f07e.jpg"},"584f":function(e,t,i){"use strict";i.d(t,"l",(function(){return r})),i.d(t,"j",(function(){return n})),i.d(t,"k",(function(){return o})),i.d(t,"i",(function(){return s})),i.d(t,"e",(function(){return l})),i.d(t,"c",(function(){return c})),i.d(t,"f",(function(){return u})),i.d(t,"h",(function(){return d})),i.d(t,"g",(function(){return m})),i.d(t,"a",(function(){return p})),i.d(t,"m",(function(){return f})),i.d(t,"b",(function(){return h})),i.d(t,"d",(function(){return v}));var a=i("b775");function r(e){return Object(a["a"])({url:"/iot/device/unAuthlist",method:"get",params:e})}function n(e){return Object(a["a"])({url:"/iot/device/listByGroup",method:"get",params:e})}function o(e){return Object(a["a"])({url:"/iot/device/shortList",method:"get",params:e})}function s(){return Object(a["a"])({url:"/iot/device/all",method:"get"})}function l(e){return Object(a["a"])({url:"/iot/device/"+e,method:"get"})}function c(e){return Object(a["a"])({url:"/iot/device/synchronization/"+e,method:"get"})}function u(e){return Object(a["a"])({url:"/iot/device/getDeviceBySerialNumber/"+e,method:"get"})}function d(){return Object(a["a"])({url:"/iot/device/statistic",method:"get"})}function m(e){return Object(a["a"])({url:"/iot/device/runningStatus/"+e,method:"get"})}function p(e){return Object(a["a"])({url:"/iot/device",method:"post",data:e})}function f(e){return Object(a["a"])({url:"/iot/device",method:"put",data:e})}function h(e){return Object(a["a"])({url:"/iot/device/"+e,method:"delete"})}function v(){return Object(a["a"])({url:"/iot/device/generator",method:"get"})}},"5f43":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"padding-left":"20px"}},[i("el-row",{attrs:{gutter:80}},[i("el-col",{attrs:{xs:24,sm:24,md:24,lg:10,xl:10}},[i("el-descriptions",{attrs:{column:1,border:"",title:e.title}},[i("el-descriptions-item",{attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("svg-icon",{attrs:{"icon-class":"ota"}}),e._v(" OTA升级 ")],1),i("el-link",{staticStyle:{"line-height":"28px","font-size":"16px","padding-right":"10px"},attrs:{underline:!1}},[e._v("Version "+e._s(e.deviceInfo.firmwareVersion))]),i("el-button",{staticStyle:{float:"right"},attrs:{type:"success",size:"mini",disabled:3!=e.deviceInfo.status},on:{click:function(t){return e.getLatestFirmware(e.deviceInfo.deviceId)}}},[e._v("检查更新")])],2),e._l(e.deviceInfo.boolList,(function(t,a){return i("el-descriptions-item",{key:a,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-open"}),e._v(" "+e._s(t.name)+" ")]),i("el-switch",{staticStyle:{"min-width":"100px"},attrs:{"active-text":"","inactive-text":"","active-value":"1","inactive-value":"0",disabled:e.shadowUnEnable},on:{change:function(i){return e.publishThingsModel(e.deviceInfo,t)}},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}})],2)})),e._l(e.deviceInfo.enumList,(function(t,a){return i("el-descriptions-item",{key:a,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-s-unfold"}),e._v(" "+e._s(t.name)+" ")]),i("el-select",{attrs:{placeholder:"请选择",clearable:"",disabled:e.shadowUnEnable},on:{change:function(i){return e.publishThingsModel(e.deviceInfo,t)}},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},e._l(t.enumList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],2)})),e._l(e.deviceInfo.stringList,(function(t,a){return i("el-descriptions-item",{key:a,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-tickets"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{placeholder:"请输入字符串",disabled:e.shadowUnEnable},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},[i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.publishThingsModel(e.deviceInfo,t)}},slot:"append"})],1)],2)})),e._l(e.deviceInfo.arrayList,(function(t,a){return i("el-descriptions-item",{key:a,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-tickets"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{placeholder:"请输入英文逗号分隔的字符串",disabled:e.shadowUnEnable},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},[i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.publishThingsModel(e.deviceInfo,t)}},slot:"append"})],1)],2)})),e._l(e.deviceInfo.decimalList,(function(t,a){return i("el-descriptions-item",{key:a,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{type:"number",placeholder:"请输入小数 ",disabled:e.shadowUnEnable},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},[i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.publishThingsModel(e.deviceInfo,t)}},slot:"append"})],1)],2)})),e._l(e.deviceInfo.integerList,(function(t,a){return i("el-descriptions-item",{key:a,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-paperclip"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{type:"integer",placeholder:"请输入整数 ",disabled:e.shadowUnEnable},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},[i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.publishThingsModel(e.deviceInfo,t)}},slot:"append"})],1)],2)}))],2),i("el-descriptions",{staticStyle:{margin:"40px 0"},attrs:{column:2,border:"",title:"监测数据"}},e._l(e.deviceInfo.readOnlyList,(function(t,a){return i("el-descriptions-item",{key:a},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-odometer"}),e._v(" "+e._s(t.name)+" ")]),i("el-link",{attrs:{type:"primary",underline:!1}},[e._v(e._s(t.shadow)+" "+e._s(null==t.unit?"":t.unit))])],2)})),1),1==e.deviceInfo.isShadow&&3!=e.deviceInfo.status?i("el-descriptions",{attrs:{column:1,border:"",size:"mini"}},[i("template",{slot:"title"},[i("span",{staticStyle:{"font-size":"14px",color:"#606266"}},[e._v("设备离线时状态")])]),e._l(e.deviceInfo.boolList,(function(t,a){return i("el-descriptions-item",{key:a},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-open"}),e._v(" "+e._s(t.name)+" ")]),i("el-switch",{staticStyle:{"min-width":"100px"},attrs:{size:"mini","active-text":"","inactive-text":"","active-value":"1","inactive-value":"0",disabled:""},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}})],2)})),e._l(e.deviceInfo.enumList,(function(t,a){return i("el-descriptions-item",{key:a},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-s-unfold"}),e._v(" "+e._s(t.name)+" ")]),i("el-select",{attrs:{placeholder:"请选择",clearable:"",size:"mini",disabled:""},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}},e._l(t.enumList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],2)})),e._l(e.deviceInfo.stringList,(function(t,a){return i("el-descriptions-item",{key:a},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-tickets"}),e._v(" "+e._s(t.name)+" ")]),e._v(" "+e._s(t.value)+" "+e._s(t.unit?t.unit:"")+" ")],2)})),e._l(e.deviceInfo.arrayList,(function(t,a){return i("el-descriptions-item",{key:a},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-tickets"}),e._v(" "+e._s(t.name)+" ")]),e._v(" "+e._s(t.value)+" "+e._s(t.unit?t.unit:"")+" ")],2)})),e._l(e.deviceInfo.decimalList,(function(t,a){return i("el-descriptions-item",{key:a},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(t.name)+" ")]),e._v(" "+e._s(t.value)+" "+e._s(t.unit?t.unit:"")+" ")],2)})),e._l(e.deviceInfo.integerList,(function(t,a){return i("el-descriptions-item",{key:a},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-paperclip"}),e._v(" "+e._s(t.name)+" ")]),e._v(" "+e._s(t.value)+" "+e._s(t.unit?t.unit:"")+" ")],2)}))],2):e._e()],1),e.deviceInfo.readOnlyList.length>0?i("el-col",{attrs:{xs:24,sm:24,md:24,lg:14,xl:14}},[i("el-row",{staticStyle:{"background-color":"#F5F7FA",padding:"20px 20px 10px 10px","border-radius":"15px","margin-right":"5px"},attrs:{gutter:20}},e._l(e.deviceInfo.readOnlyList,(function(e,t){return i("el-col",{key:t,attrs:{xs:24,sm:12,md:12,lg:12,xl:8}},[i("el-card",{staticStyle:{"border-radius":"30px","margin-bottom":"20px"},attrs:{shadow:"hover"}},[i("div",{ref:"map",refInFor:!0,staticStyle:{height:"230px",width:"180px",margin:"0 auto"}})])],1)})),1)],1):e._e()],1),i("el-dialog",{attrs:{title:"设备固件升级",visible:e.openFirmware,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.openFirmware=t}}},[null==e.firmware||e.deviceInfo.firmwareVersion>=e.firmware.version?i("div",{staticStyle:{"text-align":"center","font-size":"16px"}},[i("i",{staticClass:"el-icon-success",staticStyle:{color:"#67C23A"}}),e._v(" 已经是最新版本，不需要升级")]):e._e(),null!=e.firmware&&e.deviceInfo.firmwareVersion<e.firmware.version?i("el-descriptions",{attrs:{column:1,border:"",size:"large",labelStyle:{width:"100px","font-weight":"bold"}}},[i("template",{slot:"title"},[i("el-link",{attrs:{icon:"el-icon-success",type:"success",underline:!1}},[e._v(" 可以升级到以下版本")])],1),i("el-descriptions-item",{attrs:{label:"固件名称"}},[e._v(e._s(e.firmware.firmwareName))]),i("el-descriptions-item",{attrs:{label:"所属产品"}},[e._v(e._s(e.firmware.productName))]),i("el-descriptions-item",{attrs:{label:"固件版本"}},[e._v("Version "+e._s(e.firmware.version))]),i("el-descriptions-item",{attrs:{label:"下载地址"}},[i("el-link",{attrs:{href:e.getDownloadUrl(e.firmware.filePath),underline:!1,type:"primary"}},[e._v(e._s(e.getDownloadUrl(e.firmware.filePath)))])],1),i("el-descriptions-item",{attrs:{label:"固件描述"}},[e._v(e._s(e.firmware.remark))])],2):e._e(),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[null!=e.firmware&&e.deviceInfo.firmwareVersion<e.firmware.version?i("el-button",{attrs:{type:"success"},on:{click:e.otaUpgrade}},[e._v("升 级")]):e._e(),i("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1)],1)},r=[],n=i("c7eb"),o=i("1da1"),s=(i("b64b"),i("d3b7"),i("25f0"),i("b0c0"),i("d81d"),i("584f")),l=i("814a"),c=i("01ca"),u=i("313e"),d={name:"running-status",components:{},props:{device:{type:Object,default:null}},watch:{device:function(e,t){var i=this;e&&0!=e.deviceId&&(Object(s["g"])(e.deviceId).then((function(e){i.deviceInfo=e.data,i.updateDeviceStatus(i.deviceInfo),i.$nextTick((function(){this.MonitorChart()}))})),this.connectMqtt())}},data:function(){return{title:"设备控制 ",shadowUnEnable:!1,statusColor:{background:"#67C23A",color:"#fff"},firmware:{},openFirmware:!1,loading:!0,deviceInfo:{boolList:[],enumList:[],stringList:[],integerList:[],decimalList:[],arrayList:[],readOnlyList:[]},monitorChart:[{chart:{},data:{id:"",name:"",value:""}}]}},created:function(){},methods:{connectMqtt:function(){var e=this;return Object(o["a"])(Object(n["a"])().mark((function t(){return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!=e.$mqttTool.client){t.next=3;break}return t.next=3,e.$mqttTool.connect(e.vuex_token);case 3:e.mqttCallback();case 4:case"end":return t.stop()}}),t)})))()},mqttCallback:function(){var e=this;this.$mqttTool.client.on("message",(function(t,i,a){var r=t.split("/"),n=(r[1],r[2]);if(i=JSON.parse(i.toString()),"status"==r[3]&&(console.log("接收到【设备状态-运行】主题：",t),console.log("接收到【设备状态-运行】内容：",i),e.deviceInfo.serialNumber==n&&(e.deviceInfo.status=i.status,e.deviceInfo.isShadow=i.isShadow,e.deviceInfo.rssi=i.rssi,e.updateDeviceStatus(e.deviceInfo))),("property"==r[3]||"function"==r[3])&&(console.log("接收到【物模型】主题：",t),console.log("接收到【物模型】内容：",i),e.deviceInfo.serialNumber==n))for(var o=0;o<i.length;o++){for(var s=!1,l=0;l<e.deviceInfo.boolList.length&&!s;l++)if(e.deviceInfo.boolList[l].id==i[o].id){e.deviceInfo.boolList[l].shadow=i[o].value,s=!0;break}for(var c=0;c<e.deviceInfo.enumList.length&&!s;c++)if(e.deviceInfo.enumList[c].id==i[o].id){e.deviceInfo.enumList[c].shadow=i[o].value,s=!0;break}for(var u=0;u<e.deviceInfo.stringList.length&&!s;u++)if(e.deviceInfo.stringList[u].id==i[o].id){e.deviceInfo.stringList[u].shadow=i[o].value,s=!0;break}for(var d=0;d<e.deviceInfo.arrayList.length&&!s;d++)if(e.deviceInfo.arrayList[d].id==i[o].id){e.deviceInfo.arrayList[d].shadow=i[o].value,s=!0;break}for(var m=0;m<e.deviceInfo.integerList.length&&!s;m++)if(e.deviceInfo.integerList[m].id==i[o].id){e.deviceInfo.integerList[m].shadow=i[o].value,s=!0;break}for(var p=0;p<e.deviceInfo.decimalList.length&&!s;p++)if(e.deviceInfo.decimalList[p].id==i[o].id){e.deviceInfo.decimalList[p].shadow=i[o].value,s=!0;break}for(var f=0;f<e.deviceInfo.readOnlyList.length&&!s;f++)if(e.deviceInfo.readOnlyList[f].id==i[o].id){e.deviceInfo.readOnlyList[f].shadow=i[o].value;for(var h=0;h<e.monitorChart.length;h++)if(i[o].id==e.monitorChart[h].data.id){var v=[{value:i[o].value,name:e.monitorChart[h].data.name}];e.monitorChart[h].chart.setOption({series:[{data:v}]});break}s=!0;break}}}))},publishThingsModel:function(e,t){var i=this;Object(c["b"])(e.productId).then((function(a){for(var r=JSON.parse(a.data),n=0,o=0;o<r.functions.length;o++)if(t.id==r.functions[o].id){n=2;break}if(0==n)for(var s=0;s<r.properties.length;s++)if(t.id==r.properties[s].id){n=1;break}0!=n&&i.mqttPublish(n,e,t)}))},mqttPublish:function(e,t,i){var a=this,r="",n="";if(1==e)3==t.status?r="/"+t.productId+"/"+t.serialNumber+"/property-online/get":t.isShadow&&(r="/"+t.productId+"/"+t.serialNumber+"/property-offline/post"),n='[{"id":"'+i.id+'","value":"'+i.shadow+'"}]';else if(2==e)3==t.status?r="/"+t.productId+"/"+t.serialNumber+"/function-online/get":t.isShadow&&(r="/"+t.productId+"/"+t.serialNumber+"/function-offline/post"),n='[{"id":"'+i.id+'","value":"'+i.shadow+'"}]';else{if(3!=e)return;r="/"+t.productId+"/"+t.serialNumber+"/ota/get",n='{"version":'+this.firmware.version+',"downloadUrl":"'+this.getDownloadUrl(this.firmware.filePath)+'"}'}""!=r&&this.$mqttTool.publish(r,n,i.name).then((function(e){a.$modal.notifySuccess(e)})).catch((function(e){a.$modal.notifyError(e)}))},updateDeviceStatus:function(e){3==e.status?(this.statusColor.background="#12d09f",this.title="在线模式"):1==e.isShadow?(this.statusColor.background="#409EFF",this.title="影子模式"):(this.statusColor.background="#909399",this.title="离线模式",this.shadowUnEnable=!0),this.$emit("statusEvent",this.deviceInfo.status)},otaUpgrade:function(){var e={name:"设备升级"};this.mqttPublish(3,this.deviceInfo,e),this.openFirmware=!1},getLatestFirmware:function(e){var t=this;Object(l["d"])(e).then((function(e){t.firmware=e.data,t.openFirmware=!0}))},cancel:function(){this.openFirmware=!1},getDownloadUrl:function(e){return window.location.origin+"/prod-api"+e},MonitorChart:function(){for(var e=0;e<this.deviceInfo.readOnlyList.length;e++){var t;this.monitorChart[e]={chart:u["init"](this.$refs.map[e]),data:{id:this.deviceInfo.readOnlyList[e].id,name:this.deviceInfo.readOnlyList[e].name,value:this.deviceInfo.readOnlyList[e].shadow}},t={tooltip:{formatter:" {b} <br/> {c}"+this.deviceInfo.readOnlyList[e].unit},series:[{name:this.deviceInfo.readOnlyList[e].type,type:"gauge",min:this.deviceInfo.readOnlyList[e].min,max:this.deviceInfo.readOnlyList[e].max,colorBy:"data",splitNumber:10,radius:"100%",splitLine:{distance:4},axisLabel:{fontSize:10,distance:10},axisTick:{distance:4},axisLine:{lineStyle:{width:8,color:[[.2,"#409EFF"],[.8,"#12d09f"],[1,"#F56C6C"]],opacity:.3}},pointer:{icon:"triangle",length:"60%",width:7},progress:{show:!0,width:8},detail:{valueAnimation:!0,formatter:"{value} "+this.deviceInfo.readOnlyList[e].unit,offsetCenter:[0,"80%"],fontSize:20},data:[{value:this.deviceInfo.readOnlyList[e].shadow,name:this.deviceInfo.readOnlyList[e].name}],title:{offsetCenter:[0,"115%"],fontSize:16}}]},t&&this.monitorChart[e].chart.setOption(t)}}}},m=d,p=i("2877"),f=Object(p["a"])(m,a,r,!1,null,null,null);t["default"]=f.exports},7168:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"padding-left":"20px"}},[i("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[i("el-form-item",{attrs:{label:"日志类型",prop:"logType"}},[i("el-select",{attrs:{placeholder:"请选择类型",clearable:"",size:"small"},model:{value:e.queryParams.logType,callback:function(t){e.$set(e.queryParams,"logType",t)},expression:"queryParams.logType"}},e._l(e.dict.type.iot_device_log_type,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),i("el-form-item",{attrs:{label:"标识符",prop:"identity"}},[i("el-input",{attrs:{placeholder:"请输入标识符",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.identity,callback:function(t){e.$set(e.queryParams,"identity",t)},expression:"queryParams.identity"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.deviceLogList,size:"mini"}},[i("el-table-column",{attrs:{label:"类型",align:"center",prop:"logType",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.iot_device_log_type,value:t.row.logType}})]}}])}),i("el-table-column",{attrs:{label:"模式",align:"center",prop:"logType",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.mode?i("el-tag",{attrs:{type:"primary"}},[e._v("影子模式")]):2==t.row.mode?i("el-tag",{attrs:{type:"success"}},[e._v("在线模式")]):i("el-tag",{attrs:{type:"info"}},[e._v("其他信息")])]}}])}),i("el-table-column",{attrs:{label:"时间",align:"center",prop:"createTime",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.createTime))])]}}])}),i("el-table-column",{attrs:{label:"标识符",align:"center",prop:"identity"}}),i("el-table-column",{attrs:{label:"动作",align:"left","header-align":"center",prop:"logValue"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{domProps:{innerHTML:e._s(e.formatValueDisplay(t.row))}})]}}])}),i("el-table-column",{attrs:{label:"备注","header-align":"center",align:"left",prop:"remark"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(null==t.row.remark?"无":t.row.remark)+" ")]}}])})],1),i("div",{staticStyle:{height:"40px"}},[i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1)],1)},r=[],n=i("5530"),o=(i("b64b"),i("b0c0"),i("a035")),s=i("01ca"),l={name:"DeviceLog",dicts:["iot_device_log_type","iot_yes_no"],props:{device:{type:Object,default:null}},watch:{device:function(e,t){this.deviceInfo=e,this.deviceInfo&&0!=this.deviceInfo.deviceId&&(this.queryParams.deviceId=this.deviceInfo.deviceId,this.getList(),this.getCacheThingsModdel(this.deviceInfo.productId))}},data:function(){return{thingsModel:{},loading:!0,showSearch:!0,total:0,deviceLogList:[],queryParams:{pageNum:1,pageSize:10,logType:null,logValue:null,deviceId:null,deviceName:null,identity:null,isMonitor:null}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(o["a"])(this.queryParams).then((function(t){e.deviceLogList=t.rows,e.total=t.total,e.loading=!1}))},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleExport:function(){this.download("iot/deviceLog/export",Object(n["a"])({},this.queryParams),"deviceLog_".concat((new Date).getTime(),".xlsx"))},getCacheThingsModdel:function(e){var t=this;Object(s["b"])(e).then((function(e){t.thingsModel=JSON.parse(e.data)}))},formatValueDisplay:function(e){if(1==e.logType){var t=this.getThingsModelItem(1,e.identity);if(""!=t)return t.name+'： <span style="color:#409EFF;">'+this.getThingsModelItemValue(t,e.logValue)+" "+(void 0!=t.datatype.unit?t.datatype.unit:"")+"</span>"}else if(2==e.logType){var i=this.getThingsModelItem(2,e.identity);if(""!=i)return i.name+'： <span style="color:#409EFF">'+this.getThingsModelItemValue(i,e.logValue)+" "+(void 0!=i.datatype.unit?i.datatype.unit:"")+"</span>"}else if(3==e.logType){var a=this.getThingsModelItem(3,e.identity);if(""!=a)return a.name+'： <span style="color:#409EFF">'+this.getThingsModelItemValue(a,e.logValue)+" "+(void 0!=a.datatype.unit?a.datatype.unit:"")+"</span>"}else{if(4==e.logType)return'<span style="font-weight:bold">设备升级</span>';if(5==e.logType)return'<span style="font-weight:bold">设备上线</span>';if(6==e.logType)return'<span style="font-weight:bold">设备离线</span>'}return""},getThingsModelItemValue:function(e,t){if("bool"==e.datatype.type){if("0"==t)return e.datatype.falseText;if("1"==t)return e.datatype.trueText}else if("enum"==e.datatype.type)for(var i=0;i<e.datatype.enumList.length;i++)if(t==e.datatype.enumList[i].value)return e.datatype.enumList[i].text;return t},getThingsModelItem:function(e,t){if(1==e&&this.thingsModel.properties){for(var i=0;i<this.thingsModel.properties.length;i++)if(this.thingsModel.properties[i].id==t)return this.thingsModel.properties[i]}else if(2==e&&this.thingsModel.functions){for(var a=0;a<this.thingsModel.functions.length;a++)if(this.thingsModel.functions[a].id==t)return this.thingsModel.functions[a]}else if(3==e&&this.thingsModel.events)for(var r=0;r<this.thingsModel.events.length;r++)if(this.thingsModel.events[r].id==t)return this.thingsModel.events[r];return""}}},c=l,u=i("2877"),d=Object(u["a"])(c,a,r,!1,null,null,null);t["default"]=d.exports},"814a":function(e,t,i){"use strict";i.d(t,"e",(function(){return r})),i.d(t,"d",(function(){return n})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return s})),i.d(t,"f",(function(){return l})),i.d(t,"b",(function(){return c}));var a=i("b775");function r(e){return Object(a["a"])({url:"/iot/firmware/list",method:"get",params:e})}function n(e){return Object(a["a"])({url:"/iot/firmware/getLatest/"+e,method:"get"})}function o(e){return Object(a["a"])({url:"/iot/firmware/"+e,method:"get"})}function s(e){return Object(a["a"])({url:"/iot/firmware",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/iot/firmware",method:"put",data:e})}function c(e){return Object(a["a"])({url:"/iot/firmware/"+e,method:"delete"})}},"9b9c":function(e,t,i){"use strict";i.d(t,"e",(function(){return r})),i.d(t,"f",(function(){return n})),i.d(t,"d",(function(){return o})),i.d(t,"a",(function(){return s})),i.d(t,"g",(function(){return l})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return u}));var a=i("b775");function r(e){return Object(a["a"])({url:"/iot/product/list",method:"get",params:e})}function n(){return Object(a["a"])({url:"/iot/product/shortList",method:"get"})}function o(e){return Object(a["a"])({url:"/iot/product/"+e,method:"get"})}function s(e){return Object(a["a"])({url:"/iot/product",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/iot/product",method:"put",data:e})}function c(e){return Object(a["a"])({url:"/iot/product/status/",method:"put",data:e})}function u(e){return Object(a["a"])({url:"/iot/product/"+e,method:"delete"})}},a035:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));var a=i("b775");function r(e){return Object(a["a"])({url:"/iot/deviceLog/list",method:"get",params:e})}function n(e){return Object(a["a"])({url:"/iot/deviceLog/monitor",method:"get",params:e})}},b52e:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"padding-left":"20px"}},[i("el-row",{staticClass:"mb8",attrs:{gutter:10}},[i("el-col",{attrs:{span:1.5}},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:share"],expression:"['iot:device:share']"}],attrs:{type:"primary",plain:"",icon:"el-icon-share",size:"mini"},on:{click:e.selectUser}},[e._v("分享设备")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-refresh",size:"mini"},on:{click:e.getList}},[e._v("刷新")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.deviceUserList,size:"mini"},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{label:"用户编号",align:"center",prop:"userId",width:"100"}}),i("el-table-column",{attrs:{label:"用户名称",align:"center",prop:"userName"}}),i("el-table-column",{attrs:{label:"手机号码",align:"center",prop:"phonenumber",width:"150"}}),i("el-table-column",{attrs:{label:"用户类型",align:"center",prop:"isOwner",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isOwner?i("el-tag",{attrs:{type:"primary"}},[e._v("主人")]):i("el-tag",{attrs:{type:"success"}},[e._v("分享")])]}}])}),i("el-table-column",{attrs:{label:"分享时间",align:"center",prop:"createTime",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.parseTime(t.row.createTime,"{y}-{m}-{d}")))])]}}])}),i("el-table-column",{attrs:{label:"备注",align:"left",prop:"remark","header-align":"center","min-width":"150"}}),i("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.isOwner?i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:share"],expression:"['iot:device:share']"}],attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(i){return e.handleUpdate(t.row)}}},[e._v("备注")]):e._e(),0==t.row.isOwner?i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:share"],expression:"['iot:device:share']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.handleDelete(t.row)}}},[e._v("取消分享")]):e._e()]}}])})],1),i("el-dialog",{attrs:{title:e.title,visible:e.open,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",rows:"4"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}}),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),i("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),i("user-list",{ref:"userList",attrs:{device:e.devices}})],1)},r=[],n=i("5530"),o=(i("d81d"),i("e018")),s=i("2544"),l={name:"device-user",dicts:["iot_yes_no"],components:{userList:o["default"]},props:{device:{type:Object,default:null}},watch:{device:function(e,t){this.deviceInfo=e,this.devices=[e],this.deviceInfo&&0!=this.deviceInfo.deviceId&&(this.queryParams.deviceId=this.deviceInfo.deviceId,this.getList())}},data:function(){return{devices:[],loading:!0,ids:[],single:!0,multiple:!0,total:0,deviceUserList:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:10,deviceName:null,userName:null,userId:null,tenantName:null,isOwner:null},form:{},rules:{deviceName:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],userName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}]}}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.loading=!0,Object(s["e"])(this.queryParams).then((function(t){e.deviceUserList=t.rows,e.total=t.total,e.loading=!1}))},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={deviceId:null,userId:null,deviceName:null,userName:null,tenantId:null,tenantName:null,isOwner:null,limitNum:null,delFlag:null,createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null},this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.deviceId})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="添加设备用户"},handleUpdate:function(e){var t=this;this.reset();var i=e.deviceId||this.ids;Object(s["d"])(i,e.userId).then((function(e){t.form=e.data,t.open=!0,t.title="用户备注"}))},submitForm:function(){var e=this;null!=this.form.deviceId&&Object(s["f"])(this.form).then((function(t){e.$modal.msgSuccess("备注成功"),e.open=!1,e.getList()}))},handleDelete:function(e){var t=this,i=e;this.$modal.confirm("确认取消分享设备？").then((function(){return Object(s["c"])(i)})).then((function(){t.getList(),t.$modal.msgSuccess("取消分享成功")})).catch((function(){}))},handleExport:function(){this.download("iot/deviceUser/export",Object(n["a"])({},this.queryParams),"deviceUser_".concat((new Date).getTime(),".xlsx"))},selectUser:function(){this.devices=[this.device],this.$refs.userList.openSelectUser=!0}}},c=l,u=i("2877"),d=Object(u["a"])(c,a,r,!1,null,null,null);t["default"]=d.exports},bb86:function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"a",(function(){return n}));var a=i("b775");i("bc3a"),i("5c96"),i("21a6"),i("5f87"),i("c38a");function r(e){return Object(a["a"])({url:"/iot/tool/register",headers:{isToken:!1},method:"post",data:e})}function n(e){return Object(a["a"])({url:"/iot/tool/userList",method:"get",params:e})}},e018:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"选择用户",visible:e.openSelectUser,width:"800px"},on:{"update:visible":function(t){e.openSelectUser=t}}},[i("div",{staticStyle:{"margin-top":"-50px"}},[i("el-divider")],1),i("el-form",{ref:"queryForm",attrs:{model:e.queryParams,rules:e.rules,inline:!0,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"手机号码",prop:"phonenumber"}},[i("el-input",{staticStyle:{width:"240px"},attrs:{type:"text",placeholder:"请输入用户手机号码",minlength:"10",clearable:"",size:"small","show-word-limit":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.phonenumber,callback:function(t){e.$set(e.queryParams,"phonenumber",t)},expression:"queryParams.phonenumber"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("查询")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.userList,"highlight-current-row":"",size:"mini",border:""},on:{"current-change":e.handleCurrentChange}},[i("el-table-column",{attrs:{label:"选择",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("input",{attrs:{type:"radio",name:"user"},domProps:{checked:e.row.isSelect}})]}}])}),i("el-table-column",{key:"userId",attrs:{label:"用户编号",align:"center",prop:"userId",width:"120"}}),i("el-table-column",{key:"userName",attrs:{label:"用户名称",align:"center",prop:"userName"}}),i("el-table-column",{key:"nickName",attrs:{label:"用户昵称",align:"center",prop:"nickName"}}),i("el-table-column",{key:"phonenumber",attrs:{label:"手机号码",align:"center",prop:"phonenumber",width:"120"}}),i("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])})],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.addDeviceUser}},[e._v("分享")]),i("el-button",{on:{click:e.closeSelectUser}},[e._v("关 闭")])],1)],1)},r=[],n=(i("d3b7"),i("159b"),i("bb86")),o=i("2544"),s={name:"user-list",props:{device:{type:Array,default:null}},watch:{device:function(e,t){this.deviceInfo=e}},data:function(){return{loading:!1,ids:[],title:"",userList:[],user:{},deviceInfo:{},openSelectUser:!1,queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:0,deptId:void 0},rules:{phonenumber:[{required:!0,message:"手机号码不能为空",trigger:"blur"},{min:11,max:11,message:"手机号码长度为11位",trigger:"blur"}]}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(n["a"])(this.addDateRange(this.queryParams,this.dateRange)).then((function(t){e.userList=t.rows,e.total=t.total,e.loading=!1}))},handleQuery:function(){var e=this;this.$refs["queryForm"].validate((function(t){t&&(e.queryParams.pageNum=1,e.getList())}))},resetQuery:function(){this.$refs["queryForm"].resetFields(),this.userList=[]},setRadioSelected:function(e){for(var t=0;t<this.userList.length;t++)this.userList[t].userId==e?(this.userList[t].isSelect=!0,this.user=this.userList[t]):this.userList[t].isSelect=!1},handleCurrentChange:function(e){null!=e&&(this.setRadioSelected(e.userId),this.user=e)},closeSelectUser:function(){this.openSelectUser=!1,this.resetQuery()},addDeviceUser:function(){var e=this;if(null!=this.deviceInfo&&this.deviceInfo.length>0&&null!=this.user)if(1==this.deviceInfo.length){var t={};t.deviceId=this.deviceInfo[0].deviceId,t.deviceName=this.deviceInfo[0].deviceName,t.userId=this.user.userId,t.userName=this.user.userName,t.phonenumber=this.user.phonenumber,Object(o["a"])(t).then((function(t){e.$modal.msgSuccess("新增成功"),e.resetQuery(),e.openSelectUser=!1,e.$parent.getList()}))}else{t=[];this.deviceInfo.forEach((function(i){var a={};a.deviceId=i.deviceId,a.deviceName=i.deviceName,a.userId=e.user.userId,a.userName=e.user.userName,a.phonenumber=e.user.phonenumber,t.push(a)})),Object(o["b"])(t).then((function(t){e.$modal.msgSuccess("新增成功"),e.resetQuery(),e.openSelectUser=!1,e.$parent.getList()}))}else this.openSelectUser=!1}}},l=s,c=i("2877"),u=Object(c["a"])(l,a,r,!1,null,null,null);t["default"]=u.exports},e51f:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"选择产品",visible:e.open,width:"800px"},on:{"update:visible":function(t){e.open=t}}},[i("div",{staticStyle:{"margin-top":"-55px"}},[i("el-divider",{staticStyle:{"margin-top":"-30px"}}),i("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[i("el-form-item",{attrs:{label:"产品名称",prop:"productName"}},[i("el-input",{attrs:{placeholder:"请输入产品名称",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.productName,callback:function(t){e.$set(e.queryParams,"productName",t)},expression:"queryParams.productName"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"singleTable",attrs:{data:e.productList,"highlight-current-row":"",size:"mini"},on:{"row-click":e.rowClick}},[i("el-table-column",{attrs:{label:"选择",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("input",{attrs:{type:"radio",name:"product"},domProps:{checked:e.row.isSelect}})]}}])}),i("el-table-column",{attrs:{label:"产品名称",align:"center",prop:"productName"}}),i("el-table-column",{attrs:{label:"分类名称",align:"center",prop:"categoryName"}}),i("el-table-column",{attrs:{label:"租户名称",align:"center",prop:"tenantName"}}),i("el-table-column",{attrs:{label:"授权码",align:"center",prop:"status",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.isAuthorize?i("el-tag",{attrs:{type:"success"}},[e._v("启用")]):e._e(),0==t.row.isAuthorize?i("el-tag",{attrs:{type:"info"}},[e._v("未启用")]):e._e()]}}])}),i("el-table-column",{attrs:{label:"认证方式",align:"center",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.iot_vertificate_method,value:t.row.vertificateMethod}})]}}])}),i("el-table-column",{attrs:{label:"联网方式",align:"center",prop:"networkMethod"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.iot_network_method,value:t.row.networkMethod}})]}}])}),i("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.parseTime(t.row.createTime,"{y}-{m}-{d}")))])]}}])})],1),i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.confirmSelectProduct}},[e._v("确定")]),i("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("关 闭")])],1)])},r=[],n=(i("a9e3"),i("9b9c")),o={name:"ProductList",dicts:["iot_vertificate_method","iot_network_method"],props:{productId:{type:Number,default:0}},data:function(){return{loading:!0,total:0,open:!1,productList:[],product:{},queryParams:{pageNum:1,pageSize:10,productName:null,categoryId:null,categoryName:null,tenantId:null,tenantName:null,isSys:null,status:2,deviceType:null,networkMethod:null}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(n["e"])(this.queryParams).then((function(t){e.productList=t.rows,e.total=t.total,0!=e.productId&&e.setRadioSelected(e.productId),e.loading=!1}))},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},rowClick:function(e){null!=e&&(this.setRadioSelected(e.productId),this.product=e)},setRadioSelected:function(e){for(var t=0;t<this.productList.length;t++)this.productList[t].productId==e?this.productList[t].isSelect=!0:this.productList[t].isSelect=!1},confirmSelectProduct:function(){this.$emit("productEvent",this.product),this.open=!1},closeDialog:function(){this.open=!1}}},s=o,l=i("2877"),c=Object(l["a"])(s,a,r,!1,null,null,null);t["default"]=c.exports},e626:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-card",{staticStyle:{margin:"6px","padding-bottom":"100px"}},[i("el-tabs",{staticStyle:{padding:"10px"},attrs:{"tab-position":"left"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{name:"basic"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v(" * 基本信息")]),i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[i("el-row",{attrs:{gutter:100}},[i("el-col",{attrs:{xs:24,sm:24,md:24,lg:12,xl:8}},[i("el-form-item",{attrs:{label:"设备名称",prop:"deviceName"}},[i("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:e.form.deviceName,callback:function(t){e.$set(e.form,"deviceName",t)},expression:"form.deviceName"}},[0!=e.form.deviceId?i("el-button",{attrs:{slot:"append"},on:{click:e.openSummaryDialog},slot:"append"},[e._v("摘要")]):e._e()],1)],1),i("el-form-item",{attrs:{label:"",prop:"serialNumber"}},[i("template",{slot:"label"},[i("span",{staticStyle:{color:"red"}},[e._v("* ")]),e._v("设备编号 ")]),i("el-input",{attrs:{placeholder:"请输入设备编号",disabled:1!=e.form.status,maxlength:"32"},model:{value:e.form.serialNumber,callback:function(t){e.$set(e.form,"serialNumber",t)},expression:"form.serialNumber"}},[i("el-button",{attrs:{slot:"append",loading:e.genDisabled,disabled:1!=e.form.status},on:{click:e.generateNum},slot:"append"},[e._v("生成")])],1)],2),i("el-form-item",{attrs:{label:"",prop:"productName"}},[i("template",{slot:"label"},[i("span",{staticStyle:{color:"red"}},[e._v("* ")]),e._v("所属产品 ")]),i("el-input",{attrs:{readonly:"",placeholder:"请选择产品",disabled:1!=e.form.status},model:{value:e.form.productName,callback:function(t){e.$set(e.form,"productName",t)},expression:"form.productName"}},[i("el-button",{attrs:{slot:"append",disabled:1!=e.form.status},on:{click:function(t){return e.selectProduct()}},slot:"append"},[e._v("选择")])],1)],2),i("el-form-item",{attrs:{label:"固件版本",prop:"firmwareVersion"}},[i("el-input",{attrs:{placeholder:"请输入固件版本",type:"number",step:"0.1",disabled:1!=e.form.status},model:{value:e.form.firmwareVersion,callback:function(t){e.$set(e.form,"firmwareVersion",t)},expression:"form.firmwareVersion"}},[i("template",{slot:"prepend"},[e._v("Version")])],2)],1),i("el-form-item",{attrs:{label:"禁用设备",prop:"deviceStatus"}},[i("el-switch",{attrs:{"active-text":"","inactive-text":"",disabled:1==e.form.status,"active-value":1,"inactive-value":0,"active-color":"#F56C6C"},model:{value:e.deviceStatus,callback:function(t){e.deviceStatus=t},expression:"deviceStatus"}})],1),i("el-form-item",{attrs:{label:"设备影子",prop:"isShadow"}},[i("el-switch",{attrs:{"active-text":"","inactive-text":"","active-value":1,"inactive-value":0},model:{value:e.form.isShadow,callback:function(t){e.$set(e.form,"isShadow",t)},expression:"form.isShadow"}})],1),i("el-form-item",{attrs:{label:"备注信息",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",rows:"3"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),i("el-col",{attrs:{xs:24,sm:24,md:24,lg:12,xl:8}},[i("el-form-item",{attrs:{label:"定位方式",prop:"locationWay"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择设备状态",clearable:"",size:"small"},model:{value:e.form.locationWay,callback:function(t){e.$set(e.form,"locationWay",t)},expression:"form.locationWay"}},e._l(e.dict.type.iot_location_way,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:Number(e.value)}})})),1)],1),i("el-form-item",{attrs:{label:"设备经度",prop:"longitude"}},[i("el-input",{attrs:{placeholder:"请输入设备经度",type:"number",disabled:3!=e.form.locationWay},model:{value:e.form.longitude,callback:function(t){e.$set(e.form,"longitude",t)},expression:"form.longitude"}},[i("el-link",{attrs:{slot:"append",underline:!1,href:"https://api.map.baidu.com/lbsapi/getpoint/index.html",target:"_blank",disabled:3!=e.form.locationWay},slot:"append"},[e._v("坐标拾取")])],1)],1),i("el-form-item",{attrs:{label:"设备纬度",prop:"latitude"}},[i("el-input",{attrs:{placeholder:"请输入设备纬度",type:"number",disabled:3!=e.form.locationWay},model:{value:e.form.latitude,callback:function(t){e.$set(e.form,"latitude",t)},expression:"form.latitude"}},[i("el-link",{attrs:{slot:"append",underline:!1,href:"https://api.map.baidu.com/lbsapi/getpoint/index.html",target:"_blank",disabled:3!=e.form.locationWay},slot:"append"},[e._v("坐标拾取")])],1)],1),i("el-form-item",{attrs:{label:"所在地址",prop:"networkAddress"}},[i("el-input",{attrs:{placeholder:"请输入设备所在地址",disabled:3!=e.form.locationWay},model:{value:e.form.networkAddress,callback:function(t){e.$set(e.form,"networkAddress",t)},expression:"form.networkAddress"}})],1),i("el-form-item",{attrs:{label:"入网地址",prop:"networkIp"}},[i("el-input",{attrs:{placeholder:"设备入网IP",disabled:""},model:{value:e.form.networkIp,callback:function(t){e.$set(e.form,"networkIp",t)},expression:"form.networkIp"}})],1),i("el-form-item",{attrs:{label:"激活时间",prop:"activeTime"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:"",type:"date","value-format":"yyyy-MM-dd",placeholder:"设备激活时间",disabled:""},model:{value:e.form.activeTime,callback:function(t){e.$set(e.form,"activeTime",t)},expression:"form.activeTime"}})],1),i("el-form-item",{attrs:{label:"设备信号",prop:"rssi"}},[i("el-input",{attrs:{placeholder:"设备信号强度",disabled:""},model:{value:e.form.rssi,callback:function(t){e.$set(e.form,"rssi",t)},expression:"form.rssi"}})],1),i("el-form-item",{attrs:{label:"设备状态",prop:"status"}},[i("dict-tag",{staticStyle:{width:"60px",display:"inline-block"},attrs:{options:e.dict.type.iot_device_status,value:e.form.status}})],1)],1),i("el-col",{attrs:{xs:24,sm:24,md:24,lg:12,xl:8}},[i("div",{staticStyle:{border:"1px solid #dfe4ed","border-radius":"5px",padding:"5px","text-align":"center","line-height":"400px"}},[i("div",{staticStyle:{height:"435px",width:"100%"},attrs:{id:"map"}},[e._v("地图展示区域，新增后显示")])])])],1)],1),i("el-form",{staticStyle:{"margin-top":"50px"},attrs:{"label-width":"100px"}},[i("el-form-item",{staticStyle:{"text-align":"center","margin-left":"-100px","margin-top":"10px"}},[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.submitForm}},[e._v("保 存")])],1)],1),i("product-list",{ref:"productList",attrs:{productId:e.form.productId},on:{productEvent:function(t){return e.getProductData(t)}}})],1),i("el-tab-pane",{attrs:{name:"runningStatus",disabled:0==e.form.deviceId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("运行状态")]),i("running-status",{ref:"runningStatus",attrs:{device:e.form},on:{statusEvent:function(t){return e.getDeviceStatus(t)}}})],1),i("el-tab-pane",{attrs:{name:"deviceTimer",disabled:0==e.form.deviceId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("设备定时")]),i("device-timer",{ref:"deviceTimer",attrs:{device:e.form}})],1),i("el-tab-pane",{attrs:{name:"deviceUser",disabled:0==e.form.deviceId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("设备用户")]),i("device-user",{ref:"deviceUser",attrs:{device:e.form},on:{userEvent:function(t){return e.getUserData(t)}}})],1),i("el-tab-pane",{attrs:{name:"deviceLog",disabled:0==e.form.deviceId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("设备日志")]),i("device-log",{ref:"deviceLog",attrs:{device:e.form}})],1),i("el-tab-pane",{attrs:{name:"deviceStastic",disabled:0==e.form.deviceId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("监测统计")]),i("device-statistic",{ref:"deviceStatistic",attrs:{device:e.form}})],1),i("el-tab-pane",{attrs:{label:"",disabled:"",name:"device01"}}),i("el-tab-pane",{attrs:{label:"",disabled:"",name:"device02"}}),i("el-tab-pane",{attrs:{label:"",disabled:"",name:"device03"}}),i("el-tab-pane",{attrs:{name:"device04"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"用于查看发送的指令，设备是否已经响应",placement:"right-start"}},[i("el-button",{attrs:{type:"success",size:"mini",disabled:0==e.form.deviceId||!e.isLoaded},on:{click:function(t){return e.deviceSynchronization()}}},[e._v("数据同步")])],1)],1)]),i("el-tab-pane",{attrs:{name:"device05"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("el-button",{attrs:{type:"info",size:"mini",disabled:!e.isLoaded},on:{click:function(t){return e.goBack()}}},[e._v("返回列表")])],1)])],1),i("el-dialog",{attrs:{title:"摘要（设备上传的只读数据）",visible:e.openSummary,width:"700px","append-to-body":""},on:{"update:visible":function(t){e.openSummary=t}}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:14}},[i("div",{staticStyle:{border:"1px solid #ccc","margin-top":"-15px",height:"350px",width:"360px",overflow:"scroll"}},[i("json-viewer",{attrs:{value:e.summary,"expand-depth":10,copyable:""},scopedSlots:e._u([{key:"copy",fn:function(){return[e._v(" 复制 ")]},proxy:!0}])})],1)]),i("el-col",{attrs:{span:10}},[i("div",{staticStyle:{border:"1px solid #ccc",width:"200px","text-align":"center","margin-left":"20px","margin-top":"-10px"}},[i("vue-qr",{attrs:{text:e.qrText,size:200}}),i("div",{staticStyle:{"padding-bottom":"10px"}},[e._v("设备二维码")])],1)])],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info"},on:{click:e.closeSummaryDialog}},[e._v("关 闭")])],1)],1)],1)},r=[],n=i("c7eb"),o=i("1da1"),s=(i("b64b"),i("d3b7"),i("25f0"),i("ac1f"),i("00b4"),i("e9c4"),i("d81d"),i("349e")),l=i.n(s),c=(i("0b22"),i("e51f")),u=i("7168"),d=i("b52e"),m=i("5f43"),p=i("f14e"),f=i("7a72"),h=i("658f5"),v=i.n(h),b=i("09cb"),g=i("584f"),y={name:"DeviceEdit",dicts:["iot_device_status","iot_location_way"],components:{deviceLog:u["default"],deviceUser:d["default"],deviceStatistic:p["default"],runningStatus:m["default"],productList:c["default"],deviceTimer:f["default"],JsonViewer:l.a,vueQr:v.a},watch:{activeName:function(e){"deviceStastic"==e&&this.$nextTick((function(){}))}},computed:{deviceStatus:{set:function(e){this.form.status=1==e?2:0==e?4:this.oldDeviceStatus},get:function(){return 2==this.form.status?1:0}}},data:function(){return{qrText:"wumei-smart",openSummary:!1,isLoaded:!1,genDisabled:!1,activeName:"basic",loading:!0,oldDeviceStatus:null,form:{productId:0,status:1,locationWay:1,firmwareVersion:1},summary:[],imageUrl:i("32d1"),baseUrl:"/prod-api",map:null,local:null,mk:null,latitude:"",longitude:"",keyWords:"",rules:{deviceName:[{required:!0,message:"设备名称不能为空",trigger:"blur"},{min:2,max:32,message:"设备名称长度在 2 到 32 个字符",trigger:"blur"}],firmwareVersion:[{required:!0,message:"固件版本不能为空",trigger:"blur"}]}}},created:function(){var e=this;this.form.deviceId=this.$route.query&&this.$route.query.deviceId,0!=this.form.deviceId&&(this.connectMqtt(),this.getDevice(this.form.deviceId)),setTimeout((function(){e.isLoaded=!0}),2e3)},destroyed:function(){this.mqttUnSubscribe(this.form)},methods:{connectMqtt:function(){var e=this;return Object(o["a"])(Object(n["a"])().mark((function t(){return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!=e.$mqttTool.client){t.next=3;break}return t.next=3,e.$mqttTool.connect(e.vuex_token);case 3:e.mqttCallback();case 4:case"end":return t.stop()}}),t)})))()},mqttCallback:function(){var e=this;this.$mqttTool.client.on("message",(function(t,i,a){var r=t.split("/"),n=(r[1],r[2]);i=JSON.parse(i.toString()),"status"==r[3]&&(console.log("接收到【设备状态-详情】主题：",t),console.log("接收到【设备状态-详情】内容：",i),e.form.serialNumber==n&&(e.oldDeviceStatus=i.status,e.form.status=i.status,e.form.isShadow=i.isShadow,e.form.rssid=i.rssid))}))},mqttSubscribe:function(e){var t="/"+e.productId+"/"+e.serialNumber+"/status/post",i="/"+e.productId+"/"+e.serialNumber+"/property/post",a="/"+e.productId+"/"+e.serialNumber+"/function/post",r=[];r.push(t),r.push(i),r.push(a),this.$mqttTool.subscribe(r)},mqttUnSubscribe:function(e){var t="/"+e.productId+"/"+e.serialNumber+"/status/post",i="/"+e.productId+"/"+e.serialNumber+"/property/post",a="/"+e.productId+"/"+e.serialNumber+"/function/post",r=[];r.push(t),r.push(i),r.push(a),console.log("取消订阅",r),this.$mqttTool.unsubscribe(r)},getDeviceStatus:function(e){this.form.status=e},deviceSynchronization:function(){var e=this;Object(g["c"])(this.form.serialNumber).then((function(t){e.form=t.data,e.activeName="runningStatus",e.oldDeviceStatus=e.form.status,e.loadMap()}))},getDevice:function(e){var t=this;Object(g["e"])(e).then((function(e){t.form=e.data,null!=t.form.summary&&""!=t.form.summary&&(t.summary=JSON.parse(t.form.summary)),t.oldDeviceStatus=t.form.status,t.loadMap(),t.mqttSubscribe(t.form)}))},loadMap:function(){var e=this;this.$nextTick((function(){Object(b["a"])().then((function(){e.getmap()}))}))},goBack:function(){var e={path:"/iot/device",query:{t:Date.now(),pageNum:this.$route.query.pageNum}};this.$tab.closeOpenPage(e),this.reset()},reset:function(){this.form={deviceId:0,deviceName:null,productId:null,productName:null,userId:null,userName:null,tenantId:null,tenantName:null,serialNumber:null,firmwareVersion:1,status:1,rssi:null,networkAddress:null,networkIp:null,longitude:null,latitude:null,activeTime:null,createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null,locationWay:1},this.deviceStatus=0,this.resetForm("form")},submitForm:function(){var e=this;if(null!=this.form.serialNumber&&0!=this.form.serialNumber){var t=/^[0-9a-zA-Z]+$/;t.test(this.form.serialNumber)?null!=this.form.productId&&0!=this.form.productId?this.$refs["form"].validate((function(t){t&&(0!=e.form.deviceId?Object(g["m"])(e.form).then((function(t){0==t.data?e.$modal.alertError(t.msg):(e.$modal.alertSuccess("修改成功"),e.form=JSON.parse(JSON.stringify(e.form)),e.loadMap())})):Object(g["a"])(e.form).then((function(t){e.form=t.data,console.log(t),e.oldDeviceStatus=e.form.status,null==e.form.deviceId||0==e.form.deviceId?e.$modal.alertError("设备编号已经存在，添加设备失败"):(2==e.form.status&&(e.deviceStatus=1),e.$modal.alertSuccess("添加设备成功"),e.loadMap())})))})):this.$modal.alertError("所属产品不能为空"):this.$modal.alertError("设备编号只能是字母和数字")}else this.$modal.alertError("设备编号不能为空")},selectProduct:function(){this.$refs.productList.open=!0,this.$refs.productList.getList()},getProductData:function(e){this.form.productId=e.productId,this.form.productName=e.productName},getUserData:function(e){},openSummaryDialog:function(){var e={type:1,deviceNumber:this.form.serialNumber,productId:this.form.productId,productName:this.form.productName};this.qrText=JSON.stringify(e),this.openSummary=!0},closeSummaryDialog:function(){this.openSummary=!1},getmap:function(){this.map=new BMap.Map("map");var e=null;e=null!=this.form.longitude&&""!=this.form.longitude&&null!=this.form.latitude&&""!=this.form.latitude?new BMap.Point(this.form.longitude,this.form.latitude):new BMap.Point(116.404,39.915),this.map.centerAndZoom(e,19),this.map.enableScrollWheelZoom(!0),this.map.addControl(new BMap.NavigationControl),this.mk=new BMap.Marker(e),this.map.addOverlay(this.mk),this.map.panTo(e)},generateNum:function(){var e=this;this.genDisabled=!0,Object(g["d"])().then((function(t){e.form.serialNumber=t.data,e.genDisabled=!1}))}}},w=y,_=i("2877"),k=Object(_["a"])(w,a,r,!1,null,null,null);t["default"]=k.exports},f14e:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"padding-left":"20px"}},[i("el-row",[i("el-col",{attrs:{span:24}},[i("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"75px"}},[i("el-form-item",{attrs:{label:"时间范围"}},[i("el-date-picker",{staticStyle:{width:"240px"},attrs:{size:"small","value-format":"yyyy-MM-dd",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.daterangeTime,callback:function(t){e.daterangeTime=t},expression:"daterangeTime"}})],1),i("el-form-item",{attrs:{label:"最大数量"}},[i("el-input",{model:{value:e.queryParams.total,callback:function(t){e.$set(e.queryParams,"total",t)},expression:"queryParams.total"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.getStatisticData}},[e._v("查询")])],1)],1)],1),i("el-col",{attrs:{span:23}},e._l(e.monitorThings,(function(t,a){return i("div",{key:a,staticStyle:{"margin-bottom":"30px"}},[i("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{shadow:"hover","body-style":{padding:"10px 0px",overflow:"auto"}}},[i("div",{ref:"statisticMap",refInFor:!0,staticStyle:{height:"300px",width:"1080px"}})])],1)})),0)],1)],1)},r=[],n=(i("b64b"),i("4de4"),i("d3b7"),i("b0c0"),i("313e")),o=i("01ca"),s=i("a035"),l={name:"device-statistic",props:{device:{type:Object,default:null}},watch:{device:function(e,t){this.deviceInfo=e,this.deviceInfo&&0!=this.deviceInfo.deviceId&&this.getCacheThingsModdel(this.deviceInfo.productId)}},data:function(){return{loading:!1,deviceInfo:{},monitorThings:[],chart:[],daterangeTime:[],queryParams:{deviceId:0,identity:"",total:1e3}}},mounted:function(){},methods:{getCacheThingsModdel:function(e){var t=this;Object(o["b"])(e).then((function(e){var i=JSON.parse(e.data);t.monitorThings=i.properties.filter((function(e){return 1==e.isMonitor})),t.$nextTick((function(){this.getStatistic(),this.getStatisticData(this.monitorThings)}))}))},getStatisticData:function(){var e=this;this.loading=!0;for(var t=function(t){e.queryParams.deviceId=e.deviceInfo.deviceId,e.queryParams.identity=e.monitorThings[t].id,null!=e.daterangeTime&&""!=e.daterangeTime&&(e.queryParams.beginTime=e.daterangeTime[0],e.queryParams.endTime=e.daterangeTime[1]+" 23:59"),Object(s["b"])(e.queryParams).then((function(i){for(var a=i.rows,r=[],n=0;n<a.length;n++){var o=[];o[0]=a[n].time,o[1]=a[n].value,r.push(o)}e.chart[t].setOption({series:[{data:r}]}),e.loading=!1}))},i=0;i<this.monitorThings.length;i++)t(i)},getStatistic:function(){for(var e=["#1890FF","#91CB74","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],t=0;t<this.monitorThings.length;t++){var i;this.$refs.statisticMap[t].style.width=document.documentElement.clientWidth-510+"px",console.log(this.$refs.statisticMap[t]),this.chart[t]=n["init"](this.$refs.statisticMap[t]),i={animationDurationUpdate:3e3,tooltip:{trigger:"axis"},title:{left:"center",text:this.monitorThings[t].name+"统计 （单位 "+(void 0!=this.monitorThings[t].datatype.unit?this.monitorThings[t].datatype.unit:"无")+"）"},grid:{top:"80px",left:"40px",right:"20px",bottom:"60px",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},xAxis:{type:"time"},yAxis:{type:"value"},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}],series:[{name:this.monitorThings[t].name,type:"line",symbol:"none",sampling:"lttb",itemStyle:{color:t>9?e[0]:e[t]},areaStyle:{},data:[]}]},i&&this.chart[t].setOption(i)}}}},c=l,u=i("2877"),d=Object(u["a"])(c,a,r,!1,null,null,null);t["default"]=d.exports}}]);